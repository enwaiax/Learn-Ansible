# 3. åˆ¶å®šæ¼”å‘˜è¡¨ï¼šinventory

- [3. åˆ¶å®šæ¼”å‘˜è¡¨ï¼šinventory](#3-åˆ¶å®šæ¼”å‘˜è¡¨inventory)
  - [3.1 inventory æ–‡ä»¶è·¯å¾„](#31-inventory-æ–‡ä»¶è·¯å¾„)
  - [3.2 é…ç½® inventory](#32-é…ç½®-inventory)
    - [3.2.1 ä¸€è¡Œä¸€ä¸»æœºçš„å®šä¹‰æ–¹å¼](#321-ä¸€è¡Œä¸€ä¸»æœºçš„å®šä¹‰æ–¹å¼)
    - [3.2.2 inventory ä¸­çš„æ™®é€šå˜é‡](#322-inventory-ä¸­çš„æ™®é€šå˜é‡)
    - [3.2.3 ä¸»æœºåˆ†ç»„](#323-ä¸»æœºåˆ†ç»„)
    - [3.2.4 ä¸»æœºç»„å˜é‡](#324-ä¸»æœºç»„å˜é‡)
    - [3.2.5 ç»„åµŒå¥—](#325-ç»„åµŒå¥—)
    - [3.2.6 å¤šä¸ª inventory æ–‡ä»¶](#326-å¤šä¸ª-inventory-æ–‡ä»¶)
  - [3.3 åŠ¨æ€ inventory å’Œä¸´æ—¶æ·»åŠ ä¸»æœº](#33-åŠ¨æ€-inventory-å’Œä¸´æ—¶æ·»åŠ ä¸»æœº)
  - [3.4 æœ¬æ–‡ä½¿ç”¨çš„ inventory æ–‡ä»¶](#34-æœ¬æ–‡ä½¿ç”¨çš„-inventory-æ–‡ä»¶)

åœ¨æ²¡æœ‰å¯¹ Ansible åšä»»ä½•é…ç½®çš„æ—¶å€™ï¼ŒAnsible åªèƒ½é€šè¿‡ localhost æ¥æ§åˆ¶æœ¬æœºï¼Œæ‰€ä»¥åœ¨ä¹‹å‰çš„åˆä½“éªŒä¸­ï¼Œéƒ½æ˜¯è®© Ansible æŒ‡æŒ¥æœ¬æœºå»æ‰§è¡Œä»»åŠ¡ï¼Œè¿™ç¦»æ‰¹é‡æ§åˆ¶è¿œç¨‹ä¸»æœºçš„ç›®æ ‡è¿˜æœ‰ç‚¹è¿œã€‚Ansible è‚¯å®šæ˜¯æ”¯æŒæŒ‡æŒ¥è¿œç¨‹ä¸»æœºæ‰§è¡Œä»»åŠ¡çš„ï¼Œå¦‚ä½•æŒ‡å®šå“ªäº›è¿œç¨‹ä¸»æœºæ‰§è¡Œä»»åŠ¡å‘¢ï¼Ÿ

è®© Ansible å‘æŒ¥å¼ºå¤§ä½œç”¨çš„ç¬¬ä¸€æ­¥æ˜¯é…ç½® inventoryã€‚inventory è¡¨ç¤ºæ¸…å•çš„æ„æ€ï¼Œåœ¨è®¡ç®—æœºé¢†åŸŸé‡Œå¾€å¾€è¡¨ç¤ºçš„èµ„æºæ¸…å•ï¼Œåœ¨ Ansible ä¸­å®ƒè¡¨ç¤ºä¸»æœºèŠ‚ç‚¹æ¸…å•ï¼Œä¹Ÿæ˜¯èµ„æºçš„ä¸€ç§ã€‚é€šè¿‡é…ç½® inventoryï¼Œå°±å¯ä»¥å®šä¹‰å“ªäº›ç›®æ ‡ä¸»æœºæ˜¯å¯ä»¥è¢«æ§åˆ¶çš„ã€‚

è¿™æœ‰ç‚¹åƒæ˜¯æ‹ç”µå½±å‰å…ˆç¡®å®šå¥½æ¼”å‘˜è¡¨ä¸€æ ·ï¼Œæ¼”å‘˜è¡¨å°±æ˜¯ inventoryï¼Œå®šå¥½äº†æ¼”å‘˜ï¼Œç”µå½±å°±å¯ä»¥æ­£å¼å¼€æ‹ï¼Œæ¼”å‘˜åˆ™å„è‡ªå°±ä½å»å®Œæˆå‰§æœ¬åˆ†æ´¾ç»™ä»–ä»¬çš„ä»»åŠ¡(ä¹‹åè¿˜ä¼šå‘ç°ï¼Œä½¿ç”¨ Ansible è·Ÿæ‹ç”µå½±åœ¨å¾ˆå¤šæ–¹é¢æ˜¯ç›¸ä¼¼çš„)ã€‚

## 3.1 inventory æ–‡ä»¶è·¯å¾„

é»˜è®¤çš„ inventory æ–‡ä»¶æ˜¯/etc/ansible/hostsï¼Œå¯ä»¥é€šè¿‡ Ansible é…ç½®æ–‡ä»¶çš„ inventory é…ç½®æŒ‡ä»¤å»ä¿®æ”¹è·¯å¾„ã€‚

```shell
$ grep '/etc/ansible/hosts' /etc/ansible/ansible.cfg
#inventory      = /etc/ansible/hosts
```

ä½†é€šå¸¸ä¸ä¼šå»ä¿®æ”¹è¿™ä¸ªé…ç½®é¡¹ï¼Œå¦‚æœåœ¨å…¶å®ƒåœ°æ–¹å®šä¹‰äº† inventory æ–‡ä»¶ï¼Œå¯ä»¥ç›´æ¥åœ¨ ansible çš„å‘½ä»¤è¡Œä¸­ä½¿ç”¨-i é€‰é¡¹å»æŒ‡å®šè‡ªå®šä¹‰çš„ inventory æ–‡ä»¶ã€‚

```
$ ansible -i /tmp/myinv.ini ...
$ ansible-playbook -i /tmp/myinv.ini ...
```

## 3.2 é…ç½® inventory

Ansible inventory æ–‡ä»¶çš„ä¹¦å†™æ ¼å¼éµå¾ª ini é…ç½®æ ¼å¼ã€‚ä» Ansible 2.4 å¼€å§‹æ”¯æŒå…¶å®ƒæ ¼å¼ï¼Œæ¯”å¦‚ yaml æ ¼å¼çš„ inventoryã€‚æ­¤å¤„ä»¥ ini æ ¼å¼ä¸ºä¾‹ï¼Œå¾ªåºæ¸è¿›åœ°ä»‹ç» inventory çš„è§„åˆ™ã€‚å‡è®¾æ‰€æœ‰çš„è§„åˆ™éƒ½å®šä¹‰åœ¨/etc/ansible/hosts æ–‡ä»¶ä¸­ã€‚

### 3.2.1 ä¸€è¡Œä¸€ä¸»æœºçš„å®šä¹‰æ–¹å¼

Ansible é»˜è®¤æ˜¯åŸºäº ssh è¿æ¥çš„ï¼Œæ‰€ä»¥ä¸€èˆ¬æƒ…å†µä¸‹ inventory ä¸­çš„æ¯ä¸ªç›®æ ‡èŠ‚ç‚¹éƒ½é…ç½®ä¸»æœºåæˆ– IP åœ°å€ã€sshd ç›‘å¬çš„ç«¯å£å·ã€è¿æ¥çš„ç”¨æˆ·åå’Œå¯†ç ã€ssh è¿æ¥æ—¶çš„å‚æ•°ç­‰ç­‰ã€‚å½“ç„¶ï¼Œå¾ˆå¤šå‚æ•°æœ‰é»˜è®¤å€¼ï¼Œæ‰€ä»¥æœ€ç®€å•çš„æ˜¯ç›´æ¥æŒ‡å®šä¸»æœºåæˆ– IP åœ°å€å³å¯ã€‚

ä¾‹å¦‚ï¼Œåœ¨é»˜è®¤çš„ inventory æ–‡ä»¶/etc/ansible/hosts æ·»åŠ å‡ ä¸ªç›®æ ‡ä¸»æœºï¼š

```shell
node1
node2 ansible_host=192.168.200.28
192.168.200.31
192.168.200.32:22
192.168.200.3[2:3] ansible_port=22
```

è¿™æ ·å®šä¹‰ä¹‹åï¼ŒAnsible å°±å¯ä»¥æ§åˆ¶ä»»ä½•ä¸€ä¸ªç›®æ ‡ä¸»æœºäº†ï¼š

```shell
$ ansible node1 -m copy -a 'src=/etc/passwd dest=/tmp'
$ ansible 192.168.200.31 -m copy -a 'src=/etc/passwd dest=/tmp'
```

ä¸Šé¢çš„ inventory é…ç½®ä¸­ï¼š

- ç¬¬ä¸€è¡Œé€šè¿‡ä¸»æœºåå®šä¹‰ï¼Œåœ¨ ansible è¿æ¥è¯¥èŠ‚ç‚¹æ—¶ä¼šè¿›è¡Œä¸»æœºå DNS è§£æ
- ç¬¬äºŒè¡Œä¹Ÿæ˜¯é€šè¿‡ä¸»æœºåå®šä¹‰ï¼Œä½†æ˜¯ä½¿ç”¨äº†ä¸€ä¸ªä¸»æœºå˜é‡ ansible_host=IP,æ­¤æ—¶ Ansible å»è¿æ¥è¯¥ä¸»æœºæ—¶å°†ç›´æ¥é€šè¿‡ Ip åœ°å€è¿›è¡Œè¿æ¥ï¼Œè€Œä¸ä¼šè¿›è¡Œ DNS è§£æï¼Œæ‰€ä»¥æ­¤æ—¶çš„ node2 ç›¸å½“äºæ˜¯ä¸»æœºåˆ«åï¼Œå®ƒå¯ä»¥å‘½åä¸ºä»»ä½•å…¶å®ƒåç§°ï¼Œå¦‚ node_2
- ç¬¬ä¸‰è¡Œé€šè¿‡ Ip åœ°å€å®šä¹‰ä¸»æœºèŠ‚ç‚¹ç¬¬å››è¡Œå®šä¹‰æ—¶è¿˜æŒ‡å®šäº†ç«¯å£å·
- æœ€åä¸€è¡Œé€šè¿‡èŒƒå›´çš„æ–¹å¼å±•å¼€æˆä¸¤ä¸ªä¸»æœºèŠ‚ç‚¹ 192.168,266,32 å’Œ 192.168.209.33,åŒæ—¶è¿˜å®šä¹‰äº†è¿™ä¸¤ä¸ªèŠ‚ç‚¹çš„ä¸»æœºå˜é‡ ansible_port=22 è¡¨ç¤ºè¿æ¥è¿™ä¸¤ä¸ªèŠ‚ç‚¹æ—¶çš„ç«¯å£å·ä¸º 22

èŒƒå›´å±•å¼€çš„æ–¹å¼è¿˜æ”¯æŒå­—æ¯èŒƒå›´ã€‚ä¸‹é¢éƒ½æ˜¯æœ‰æ•ˆçš„ï¼š

```shell
èŒƒå›´è¡¨ç¤º      å±•å¼€ç»“æœ
--------------------
a[1:3]  -->  a1,a2,a3
[08:12] -->  08,09,10,11,12
a[a:c]  -->  aa,ab,ac
```

ä¸Šé¢ç¤ºä¾‹ä¸­ä½¿ç”¨äº†ä¸¤ä¸ªä¸»æœºå˜é‡ ansible_port å’Œ ansible_hostï¼Œå®ƒä»¬ç›´æ¥å®šä¹‰åœ¨ä¸»æœºçš„åé¢ï¼Œè¿™äº›å˜é‡éƒ½æ˜¯è¿æ¥ç›®æ ‡ä¸»æœºæ—¶çš„è¡Œä¸ºæ§åˆ¶å˜é‡ï¼Œé€šå¸¸å®ƒä»¬éƒ½èƒ½è§åçŸ¥æ„ã€‚Ansible æ”¯æŒå¾ˆå¤šä¸ªè¿æ¥æ—¶çš„è¡Œä¸ºæ§åˆ¶å˜é‡ï¼Œè€Œä¸”ä¸åŒç‰ˆæœ¬çš„ Ansible çš„è¡Œä¸ºæ§åˆ¶å˜é‡åç§°å¯èƒ½è¿˜ä¸åŒï¼Œæ¯”å¦‚åœ¨ä»¥å‰ç‰ˆæœ¬ä¸­æŒ‡å®šç«¯å£å·çš„è¡Œä¸ºå˜é‡æ˜¯ ansible_ssh_portã€‚

å®Œæ•´çš„è¿æ¥è¡Œä¸ºæ§åˆ¶å˜é‡å‚è§[å®˜æ–¹æ‰‹å†Œ](Connecting to hosts: behavioral inventory parameters)ã€‚ä¸‹é¢è§£é‡Šå‡ ä¸ªå¸¸è§çš„è¡Œä¸ºå˜é‡ã€‚

| Inventory å˜é‡å             | å«ä¹‰                                                                                                                                                                                                                                                         |
| ---------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| ansible_host                 | ansible è¿æ¥èŠ‚ç‚¹æ—¶çš„ IP åœ°å€                                                                                                                                                                                                                                 |
| ansible_port                 | è¿æ¥å¯¹æ–¹çš„ç«¯å£å·ï¼Œssh è¿æ¥æ—¶é»˜è®¤ä¸º 22                                                                                                                                                                                                                        |
| ansible_user                 | è¿æ¥å¯¹æ–¹ä¸»æœºæ—¶ä½¿ç”¨çš„ä¸»æœºåã€‚ä¸æŒ‡å®šæ—¶ï¼Œå°†ä½¿ç”¨æ‰§è¡Œ ansible æˆ– ansible-playbook å‘½ä»¤çš„ç”¨æˆ·                                                                                                                                                                      |
| ansible_password             | è¿æ¥æ—¶çš„ç”¨æˆ·å¯†ç                                                                                                                                                                                                                                              |
| ansible_connection           | è¿æ¥ç±»å‹ï¼Œæœ‰æ•ˆå€¼åŒ…æ‹¬ smartã€sshã€paramikoã€localã€dockerã€winrmï¼Œé»˜è®¤ä¸º smartã€‚smart è¡¨ç¤ºæ™ºèƒ½é€‰æ‹© ssh å’Œ paramikoï¼Œå½“ SSH æ”¯æŒ ControlPersist(å³æŒä¹…è¿æ¥)æ—¶ä½¿ç”¨ sshï¼Œå¦åˆ™ä½¿ç”¨ paramikoã€‚local å’Œ docker æ˜¯éåŸºäº ssh è¿æ¥çš„æ–¹å¼ï¼Œwinrm æ˜¯è¿æ¥ windows çš„æ’ä»¶ |
| ansible_ssh_private_key_file | æŒ‡å®šå¯†é’¥è®¤è¯ ssh è¿æ¥æ—¶çš„ç§é’¥æ–‡ä»¶                                                                                                                                                                                                                            |
| ansible_ssh_common_args      | æä¾›ç»™ sshã€sftpã€scp å‘½ä»¤çš„é¢å¤–å‚æ•°                                                                                                                                                                                                                         |
| ansible_become               | å…è®¸è¿›è¡Œæƒé™æå‡                                                                                                                                                                                                                                             |
| ansible_become_method        | æŒ‡å®šæå‡æƒé™çš„æ–¹å¼ï¼Œä¾‹å¦‚å¯ä½¿ç”¨ sudo/su/runas ç­‰æ–¹å¼                                                                                                                                                                                                          |
| ansible_become_user          | æå‡ä¸ºå“ªä¸ªç”¨æˆ·çš„æƒé™ï¼Œé»˜è®¤æå‡ä¸º root                                                                                                                                                                                                                        |
| ansible_become_password      | æå‡ä¸ºæŒ‡å®šç”¨æˆ·æƒé™æ—¶çš„å¯†ç                                                                                                                                                                                                                                    |

### 3.2.2 inventory ä¸­çš„æ™®é€šå˜é‡

åœ¨å®šä¹‰ inventory æ—¶ï¼Œé™¤äº†å¯ä»¥æŒ‡å®šè¿æ¥çš„è¡Œä¸ºæ§åˆ¶å˜é‡ï¼Œä¹Ÿå¯ä»¥æŒ‡å®š Ansible çš„æ™®é€šå˜é‡ï¼Œä»¥ä¾¿åœ¨ ansible æ‰§è¡Œä»»åŠ¡æ—¶ä½¿ç”¨ã€‚

ä¾‹å¦‚ï¼š

```
node1 node1_var="hello world"
node2 ansible_host=192.168.200.28
```

åœ¨ ansible æ‰§è¡Œä»»åŠ¡æ—¶å¯ä»¥å¼•ç”¨æ™®é€šå˜é‡ï¼š

```shell
$ ansible node1 -m debug -a 'var=node1_var'
node1 | SUCCESS => {
    "node1_var": "hello world"
}
```

### 3.2.3 ä¸»æœºåˆ†ç»„

ä¸Šé¢çš„ç¤ºä¾‹ä¸­æ˜¯æ¯è¡Œå•ç‹¬å®šä¹‰ä¸€ä¸ªä¸»æœºï¼Œè¿™æ ·çš„æ–¹å¼è™½ç„¶ç®€å•ï¼Œä½†æ˜¯æå…¶ä¸æ–¹ä¾¿ç®¡ç†å¤šä¸ªèŠ‚ç‚¹ã€‚

ä¸ºæ­¤ï¼ŒInventory æ”¯æŒå¯¹ä¸»æœºè¿›è¡Œåˆ†ç»„ï¼Œæ¯ä¸ªç»„å†…å¯ä»¥å®šä¹‰å¤šä¸ªä¸»æœºï¼Œæ¯ä¸ªä¸»æœºéƒ½å¯ä»¥å®šä¹‰åœ¨ä»»ä½•ä¸€ä¸ªæˆ–å¤šä¸ªä¸»æœºç»„å†…ã€‚

ä¾‹å¦‚ï¼š

```ini
node1 node1_var="hello world"
node2 ansible_host=192.168.200.28
192.168.200.31
192.168.200.32:22
192.168.200.3[2:3] ansible_port=22

[nginx]
192.168.200.27
192.168.200.28 ansible_password='123456'
192.168.200.29

[apache]
192.168.200.3[0:3]

[mysql]
192.168.200.27
192.168.200.29
```

è¿™é‡Œå®šä¹‰äº† 3 ä¸ªä¸»æœºç»„ï¼šnginx ä¸»æœºç»„ã€apache ä¸»æœºç»„å’Œ mysql ä¸»æœºç»„ã€‚nginx ç»„åŒ…å« 3 ä¸ªèŠ‚ç‚¹ï¼Œapache ä¸»æœºç»„åŒ…å« 4 ä¸ªèŠ‚ç‚¹ï¼Œmysql ä¸»æœºç»„åŒ…å« 2 ä¸ªèŠ‚ç‚¹ã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œmysql ç»„ä¸­çš„èŠ‚ç‚¹ä¹ŸåŒæ—¶å­˜åœ¨äº nginx ç»„å†…ï¼Œä¸€ä¸ªä¸»æœºåŒæ—¶å­˜åœ¨äºå¤šä¸ªç»„å†…æ˜¯å…è®¸ä¹Ÿæ˜¯å¿…è¦çš„åŠŸèƒ½ï¼Œåªæœ‰è¿™æ ·æ‰èƒ½æ›´ä¸ºçµæ´»çš„å¯¹å„ä¸ªèŠ‚ç‚¹è¿›è¡Œåˆ†ç±»ç®¡ç†ã€‚

æœ‰äº†ä¸»æœºç»„ï¼Œå°±å¯ä»¥è®© ansible æ§åˆ¶ä¸€ä¸ªç»„ï¼Œä»è€Œè®©è¯¥ç»„å†…æ‰€æœ‰ä¸»æœºæ‰§è¡Œä»»åŠ¡ï¼š

```
$ ansible apache -m copy -a 'src=/etc/passwd dest=/tmp'
```

Ansible é»˜è®¤é¢„å®šä¹‰äº†ä¸¤ä¸ªä¸»æœºç»„ï¼šall åˆ†ç»„å’Œ ungrouped åˆ†ç»„ã€‚

- all åˆ†ç»„ä¸­åŒ…å«æ‰€æœ‰åˆ†ç»„å†…çš„èŠ‚ç‚¹

- ungrouped åˆ†ç»„åŒ…å«æ‰€æœ‰ä¸åœ¨åˆ†ç»„å†…çš„èŠ‚ç‚¹
- è¿™ä¸¤ä¸ªåˆ†ç»„éƒ½ä¸åŒ…å« localhost è¿™ä¸ªç‰¹æ®Šçš„èŠ‚ç‚¹

å®šä¹‰äº† inventory ä¹‹åï¼Œå¯ä»¥ä½¿ç”¨ ansible --list æˆ– ansible--playbook --list å‘½ä»¤æ¥æŸ¥çœ‹ä¸»æœºç»„çš„ä¿¡æ¯ï¼Œè¿˜å¯ä»¥ä½¿ç”¨æ›´ä¸ºä¸“ä¸šçš„ ansible-inventory å‘½ä»¤æ¥æŸ¥çœ‹ä¸»æœºç»„ä¿¡æ¯ã€‚

```shell
# ä½¿ç”¨ansibleæˆ–ansible-playbookåˆ—å‡ºæ‰€æœ‰ä¸»æœº
$ ansible -i /etc/ansible/hosts nginx --list
  hosts (3):
    192.168.200.27
    192.168.200.28
    192.168.200.29

# ä½¿ç”¨ansible-inventoryåˆ—å‡ºnginxç»„ä¸­çš„ä¸»æœº
$ ansible-inventory -i /etc/ansible/hosts nginx --graph
@nginx:
  |--192.168.200.27
  |--192.168.200.28
  |--192.168.200.29

# ä½¿ç”¨ansible-inventoryåˆ—å‡ºnginxç»„ä¸­çš„ä¸»æœºï¼ŒåŒæ—¶å¸¦ä¸Šå˜é‡
$ ansible-inventory nginx --graph --vars
@nginx:
  |--192.168.200.27
  |  |--{ansible_password = 123456}
  |  |--{ansible_port = 22}
  |--192.168.200.28
  |  |--{ansible_password = 123456}
  |  |--{ansible_port = 22}
  |--192.168.200.29
  |  |--{ansible_password = 123456}
  |  |--{ansible_port = 22}
  |--{ansible_password = 123456}

# ä½¿ç”¨ansible-inventoryåˆ—å‡ºallç»„å†…çš„ä¸»æœº
$ ansible-inventory --graph all
@all:
  |--@apache:
  |  |--192.168.200.30
  |  |--192.168.200.31
  |  |--192.168.200.32
  |  |--192.168.200.33
  |--@mysql:
  |  |--192.168.200.27
  |  |--192.168.200.29
  |--@nginx:
  |  |--192.168.200.27
  |  |--192.168.200.28
  |  |--192.168.200.29
  |--@ungrouped:
  |  |--node1
  |  |--node2

# ä½¿ç”¨ansible-inventoryä»¥jsonæ ¼å¼åˆ—å‡ºæ‰€æœ‰ä¸»æœºçš„ä¿¡æ¯
$ ansible-inventory --list
```

### 3.2.4 ä¸»æœºç»„å˜é‡

æœ‰äº†ä¸»æœºç»„ä¹‹åï¼Œå¯ä»¥ç›´æ¥ä¸ºä¸»æœºç»„å®šä¹‰å˜é‡ï¼Œè¿™æ ·ç»„å†…çš„æ‰€æœ‰ä¸»æœºéƒ½å…·æœ‰è¯¥å˜é‡ã€‚

```ini
[nginx]
192.168.200.27
192.168.200.28 ansible_password=123456
192.168.200.29

[nginx:vars]
ansible_password='123456'

[all:vars]
ansible_port=22

[ungrouped:vars]
ansible_port=22
```

ä¸Šé¢[nginx:vars]è¡¨ç¤ºä¸º nginx ç»„å†…æ‰€æœ‰ä¸»æœºå®šä¹‰å˜é‡ ansible_password='123456'ã€‚è€Œ[all:vars]å’Œ[ungrouped:vars]åˆ†åˆ«è¡¨ç¤ºä¸º all å’Œ ungrouped è¿™ä¸¤ä¸ªç‰¹æ®Šçš„ä¸»æœºç»„å†…çš„æ‰€æœ‰ä¸»æœºå®šä¹‰å˜é‡ã€‚

### 3.2.5 ç»„åµŒå¥—

Inventory è¿˜æ”¯æŒä¸»æœºç»„çš„åˆ†ç»„åµŒå¥—ï¼Œå¯ä»¥é€šè¿‡[GROUP:children]çš„æ–¹å¼å®šä¹‰ä¸€ä¸ªä¸»æœºç»„ï¼Œå¹¶åœ¨å…¶ä¸­åŒ…å«å­ç»„ã€‚

ä¾‹å¦‚ï¼š

```Ini
[nginx]
192.168.200.27
192.168.200.28
192.168.200.29

[apache]
192.168.200.3[0:3]

[webservers:children]
nginx
apache
```

å…¶ä¸­ webservers ä¸»æœºç»„ä¸­åŒ…å«äº† nginx ç»„åˆ apache ç»„å†…çš„æ‰€æœ‰ä¸»æœºã€‚

ç”šè‡³ï¼Œè¿˜å¯ä»¥é€’å½’åµŒå¥—ã€‚ä¾‹å¦‚ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œcentos7 åˆ†ç»„ä¸­çš„ webservers ä»ç„¶æ˜¯ä¸€ä¸ªåŒ…å«å­ç»„çš„åˆ†ç»„ã€‚

```ini
[nginx]
192.168.200.27
192.168.200.28
192.168.200.29

[apache]
192.168.200.3[0:3]

[mysql]
192.168.200.27
192.168.200.30

[webservers:children]
nginx
apache

[centos7:children]
webservers
mysql
```

### 3.2.6 å¤šä¸ª inventory æ–‡ä»¶

å½“ Ansible è¦ç®¡ç†çš„èŠ‚ç‚¹éå¸¸å¤šæ—¶ï¼Œä»…é åˆ†ç»„çš„é€»è¾‘å¯èƒ½ä¹Ÿä¸è¶³å¤Ÿæ–¹ä¾¿ç®¡ç†ï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥å®šä¹‰å¤šä¸ª inventory æ–‡ä»¶å¹¶æ”¾åœ¨ä¸€ä¸ªç›®å½•ä¸‹ï¼Œå¹¶æŒ‰ä¸€å®šçš„å‘½åè§„åˆ™ä¸ºæ¯ä¸ª inventory å‘½åï¼Œä»¥ä¾¿è§åçŸ¥æ„ã€‚

ä¾‹å¦‚ï¼Œåˆ›å»ºä¸€ä¸ªåä¸º/etc/ansible/inventorys çš„ç›®å½•ï¼Œåœ¨å…¶ä¸­å®šä¹‰ a å’Œ b ä¸¤ä¸ª inventory æ–‡ä»¶ï¼š

```shell
/etc/ansible/inventorys/
â”œâ”€â”€ a
â””â”€â”€ b
```

å†…å®¹åˆ†åˆ«å¦‚ä¸‹ï¼š

```ini
# /etc/ansible/inventorys/açš„å†…å®¹ï¼š
[nginx]
192.168.200.27
192.168.200.28 ansible_password='123456'
192.168.200.29

[apache]
192.168.200.3[0:3]

# /etc/ansible/inventorys/bçš„å†…å®¹ï¼š
[mysql]
192.168.200.27
192.168.200.29

[web:children]
apache
nginx

[os:children]
web
mysql
```

ç°åœ¨è¦ä½¿ç”¨å¤šä¸ª inventory çš„åŠŸèƒ½ï¼Œéœ€è¦å°† inventory æŒ‡å®šä¸ºç›®å½•è·¯å¾„ã€‚

ä¾‹å¦‚ï¼ŒAnsible é…ç½®æ–‡ä»¶å°† inventory æŒ‡ä»¤è®¾ç½®ä¸ºå¯¹åº”çš„ç›®å½•ï¼š

```
inventory      = /etc/ansible/inventorys
```

æˆ–è€…ï¼Œansible æˆ– ansible-playbook å‘½ä»¤ä½¿ç”¨-i INVENTORY é€‰é¡¹æŒ‡å®šçš„è·¯å¾„åº”å½“ä¸ºç›®å½•ã€‚

```
$ ansible-inventory -i /etc/ansible/inventorys --graph all
```

æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤å°†åˆ—å‡ºæ‰€æœ‰ä¸»æœºï¼š

```
$ ansible-inventory -i /etc/ansible/inventorys --graph all
```

inventory æŒ‡å®šä¸ºç›®å½•æ—¶ï¼Œinventory æ–‡ä»¶æœ€å¥½ä¸è¦å¸¦æœ‰åç¼€ï¼Œå°±åƒç¤ºä¾‹ä¸­çš„ a å’Œ b æ–‡ä»¶ã€‚å› ä¸º Ansible å½“ä½¿ç”¨ç›®å½•ä½œä¸º inventory æ—¶ï¼Œé»˜è®¤å°†å¿½ç•¥ä¸€äº›åç¼€çš„æ–‡ä»¶ä¸å»è§£æã€‚éœ€è¦ä¿®æ”¹é…ç½®æ–‡ä»¶ä¸­çš„ inventory_ignore_extensions é¡¹æ¥ç¦æ­¢å¿½ç•¥æŒ‡å®šåç¼€(å¦‚ ini åç¼€)çš„æ–‡ä»¶ã€‚

```
#inventory_ignore_extensions = ~, .orig, .bak, .ini, .cfg, .retry, .pyc, .pyo
inventory_ignore_extensions = ~, .orig, .bak, .cfg, .retry, .pyc, .pyo
```

## 3.3 åŠ¨æ€ inventory å’Œä¸´æ—¶æ·»åŠ ä¸»æœº

åœ¨å‰é¢ä»‹ç» inventory çš„ä¸€å¤§æ®µå†…å®¹ä¸­ï¼Œæ‰€æœ‰çš„ä¸»æœºè¿æ¥ä¿¡æ¯éƒ½æ˜¯æŒ‰ç…§ Ansible è¦æ±‚çš„æ ¼å¼ç›´æ¥ä¸€æ­¥åˆ°ä½å®šä¹‰åœ¨æ–‡ä»¶ä¸­ï¼Œè¿™ç§å®šä¹‰æ–¹å¼ç§°ä¸ºé™æ€çš„ inventory(static inventory)ã€‚

Ansible è¿˜æ”¯æŒæ›´ä¸ºçµæ´»çš„ä¸»æœºæ”¶é›†æ–¹å¼ï¼šåŠ¨æ€ inventoryã€‚å®ƒå¯ä»¥å°†å…¶å®ƒç¨‹åºæˆ–å·²ç»å­˜åœ¨äºä¸€ä¸ªæ–‡ä»¶ä¸­(æ¯”å¦‚ä¸æ˜¯ inventory æ”¯æŒçš„ ini æ ¼å¼çš„æ–‡ä»¶)çš„ä¸»æœºä¿¡æ¯åŠ¨æ€æ”¶é›†èµ·æ¥ã€‚

ä¸ä»…å¦‚æ­¤ï¼ŒAnsible è¿˜å¯ä»¥é€šè¿‡ç‰¹æ®Šçš„æ¨¡å— add_host æ¥ä¸´æ—¶æ·»åŠ ä¸»æœº(ä¹Ÿå°±æ˜¯ä¸´æ—¶æ‰¾æ¥çš„æ¼”å‘˜ ğŸ˜„)ï¼Œé€šè¿‡ group_by æ¥ä¸´æ—¶è®¾ç½®ä¸»æœºç»„ã€‚è¿™ç§æ–¹å¼æ·»åŠ çš„ä¸»æœºæˆ–ä¸»æœºç»„éƒ½åªåœ¨å†…å­˜ä¸­ï¼Œåªåœ¨ Ansible è¿è¡Œæ—¶ç”Ÿæ•ˆï¼ŒAnsible é€€å‡ºä¹‹åå°±æ¶ˆå¤±ã€‚

ä½†æ— è®ºæ˜¯åŠ¨æ€ inventory è¿˜æ˜¯ add_host æˆ– group_by éƒ½ä¸é€‚åˆåœ¨æ­¤å¤„è¿›è¡Œæ¼”ç¤ºï¼Œåœ¨åé¢çš„æ–‡ç« ä¸­æ¶‰åŠåˆ°çš„æ—¶å€™æˆ‘ä¼šä»‹ç»å…¶ç”¨æ³•ã€‚

## 3.4 æœ¬æ–‡ä½¿ç”¨çš„ inventory æ–‡ä»¶

ä¸‹é¢æ˜¯æœ¬æ–‡ä½¿ç”¨çš„ inventory æ–‡ä»¶/etc/ansible/hosts çš„å†…å®¹ï¼Œåœ¨åé¢çš„æ–‡ç« ä¸­å¦‚æœæ²¡æœ‰ç‰¹åˆ«è¯´æ˜ï¼Œä¹Ÿå°†ä½¿ç”¨æ­¤å¤„çš„ inventory é…ç½®ã€‚

```ini
[nginx]
192.168.200.27
192.168.200.28
192.168.200.29

[apache]
192.168.200.3[0:3]

[webservers:children]
nginx
apache

[mysql]
192.168.200.33
```
